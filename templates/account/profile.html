<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Profile</title>
    <link rel="stylesheet" href="{% static 'CSS/header_base.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/profile.css' %}">
</head>
<body>
    <header>
        <a href="{% url 'property-index' %}" class="site-title-link">
            <div>CastleApartments</div>
        </a>
            <form action="{% url 'logout' %}" method="post" class="profile-link">
                {% csrf_token %}
                <button type="submit" class="logout-button">Log Out</button>
            </form>
    </header>

    <main class="profile-container">
        <form method="POST" action="{% url 'profile' %}">

            {% csrf_token %}
            {{ form }}
            <input type="submit" value="Update Profile">

        </form>
        <div class="profile-header">
            <h1>{{ user.get_full_name|default:"User Profile" }}</h1>
            <div class="user-role">{{ user.role|title }}</div>
        </div>

        <div class="profile-info">
            <div class="info-item">
                <label>Email:</label>
                <p>{{ user.email }}</p>
            </div>

            <div class="offers-section">
                <h2>Submitted Offers</h2>
                <div class="offers-list">
                    {% if offers %}
                        {% for offers in offers %}
                            <div class="offer-card">
                                <p><strong>Property:</strong>{{ offer.propertyId.propertyName }}</p>
                                <p><strong>Price:</strong>{{ offer.offerPrice }}</p>
                                <p><strong>Status:</strong>{{ offer.offerStatus }}</p>

                                {% if offer.offerStatus == "Accepted" %}
                                    <button class="finalize-btn" data-offer-id="{{ offer.id }}"
                                            data-property-id="{{ offer.propertyId.id }}">
                                        Finalize
                                    </button>
                                {% endif %}
                            </div>
                        {% endfor %}
                    {% else %}

                    <!-- Add dynamic offers here later -->
                        <div class="offer-placeholder">No offers submitted yet</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>

<!-- Finalize Offer Modal -->
<div id="finalizeModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close-button" id="closeModal">&times;</span>
        <form method="POST" id="finalizeForm">
            {% csrf_token %}

            <!-- Step 1: Contact Info -->
            <div class="form-step" id="step1">
                <h2>Step 1: Contact Info</h2>
                {{ finalize_form.nationalId.label_tag }} {{ finalize_form.nationalId }}
                {{ finalize_form.phoneNumber.label_tag }} {{ finalize_form.phoneNumber }}
                <button type="button" onclick="nextStep(2)">Next</button>
            </div>

            <!-- Step 2: Address -->
            <div class="form-step" id="step2" style="display:none;">
                <h2>Step 2: Address</h2>
                {{ finalize_form.address.label_tag }} {{ finalize_form.address }}
                <button type="button" onclick="nextStep(1)">Back</button>
                <button type="button" onclick="nextStep(3)">Next</button>
            </div>

            <!-- Step 3: Payment -->
            <div class="form-step" id="step3" style="display:none;">
                <h2>Step 3: Payment</h2>
                {{ finalize_form.paymentMethod.label_tag }} {{ finalize_form.paymentMethod }}

                <!-- Payment Sections -->
                <div id="creditCardFields" style="display:none;">
                    <label>Cardholder Name</label>
                    <input type="text" name="cardholder">
                    <label>Card Number</label>
                    <input type="text" name="card_number">
                    <label>Expiry Date</label>
                    <input type="text" name="card_expiry">
                    <label>CVC</label>
                    <input type="text" name="card_cvc">
                </div>

                <div id="bankFields" style="display:none;">
                    <label>Bank Name</label>
                    <input type="text" name="bank_name">
                    <label>Account Number</label>
                    <input type="text" name="account_number">
                </div>

                <div id="mortgageFields" style="display:none;">
                    <label>Mortgage Lender</label>
                    <input type="text" name="mortgage_lender">
                    <label>Agreement Reference</label>
                    <input type="text" name="agreement_ref">
                </div>

                <button type="button" onclick="nextStep(2)">Back</button>
                <button type="submit">Submit Finalized Offer</button>
            </div>
        </form>
    </div>
</div>

<script src="{% static 'JS/finalize_modal.js' %}"></script>

</body>
</html>